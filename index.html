<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Xiaoxing Chen&#39;s Space">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Xiaoxing Chen&#39;s Space">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Xiaoxing">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>Xiaoxing Chen's Space</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xiaoxing Chen's Space</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/01/21/radial_tangential_numerical_inversion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/21/radial_tangential_numerical_inversion/" class="post-title-link" itemprop="url">Numerical Inversion of Radial Tangential Distortion Model</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-21 00:00:00" itemprop="dateCreated datePublished" datetime="2022-01-21T00:00:00+08:00">2022-01-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-04 18:19:50" itemprop="dateModified" datetime="2022-02-04T18:19:50+08:00">2022-02-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/01/21/radial_tangential_numerical_inversion/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/01/21/radial_tangential_numerical_inversion/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
<head>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
        <style>
            .bib ol { counter-reset: item }
            .bib li { display: block ; counter-increment: item; }
            .bib li:before { content: " ["counter(item)"] "; }
            pre.md{
            background-color:#eee;
            border-radius: 3px;
            border: 1px solid #888 ;
            }
            table.md, table.md td, table.md th{
            border: 1px solid black;
            text-align: center;
            border-collapse: collapse;
            }
            blockquote.md{
                padding: 0 1em;
                border-left: .25em solid #888;
            }
        </style>
</head>

<body>
<h1>Background</h1>
<p>
Radial tangential distortion model is the most commonly used model in pinhole camera calibration.
Its mathematical representation is shown as formula (1-1).
By observing the formula, it is fair to say that the coordinate mapping from undistorted to distorted is natural.
But the reverse of the process is difficult because the inverse function is in implicit form.
</p>

\[
\left[
\begin{matrix}
    x_d \\
    y_d \\
\end{matrix}
 \right]
  =
  \left[
    \begin{matrix}
        x \\
        y \\
    \end{matrix}
    \right]+

  \underbrace{
    \frac{1 + k_1 r^2 + k_2 r^4 + k_3 r^6}{1 + k_4 r^2 + k_5 r^4 + k_6 r^6}
    \left[
    \begin{matrix}
        x \\
        y \\
    \end{matrix}
     \right]
  }_{\text{radial}}
  +
  \underbrace{
    \left[
    \begin{matrix}
        2xy & r^2 + 2x^2 \\
        r^2 + 2 y^2 & 2xy \\
    \end{matrix}
     \right]

     \left[
     \begin{matrix}
         p_1 \\
         p_2 \\
     \end{matrix}
      \right]
  }_{\text{tangential}}

  \tag{1-1}
\]

<p>Here \(r^2 = x^2 + y^2\) </p>

<p>
    In engineering application, both directions of the mapping are used.
    Therefore, the implementation in OpenCV may have some indications.
    Here is a description that copied from OpenCV specification:
</p>

<blockquote class="md">
    where <i>undistort</i> is an <b>approximate iterative algorithm</b> that estimates the normalized original point coordinates out of the normalized distorted point coordinates ("normalized" means that the coordinates do not depend on the camera matrix) <sup><a href="#ref1">[1]</a></sup>.
</blockquote>

<p>
    <i>An approximate iterative algorithm</i> proves the difficulty to find the close form of the undistort mapping.
    The <a href="https://github.com/opencv/opencv/blob/master/modules/calib3d/src/undistort.dispatch.cpp#L490" target="_blank" rel="noopener">implementation</a> <sup><a href="#ref2">[2]</a></sup> in OpenCV seems to call the distortion function several times and finally get the
    solution of undistort mapping. The workflow looks like a Newton Method but without any derivative calculation.
</p>

<!-- <h2>Jacobi</h2>

<p>\(\frac{\partial d_r}{\partial x}\) </p>


\[
\frac{2 x k_1 + 4x(x^2+y^2) k_2 + 6x(x^2+y^2)^2 k_3}{1 + k_4 (x^2+y^2) + k_5 (x^2+y^2)^2 + k_6 (x^2+y^2)^3}
\]

\[
\frac{1 + k_1 (x^2+y^2) + k_2 (x^2+y^2)^2 + k_3 (x^2+y^2)^3}{1 + k_4 (x^2+y^2) + k_5 (x^2+y^2)^2 + k_6 (x^2+y^2)^3}
\]

\[
    \left[
    \begin{matrix}
        \frac{\partial x_d}{\partial x} & \frac{\partial x_d}{\partial y} \\
        \frac{\partial y_d}{\partial x} & \frac{\partial y_d}{\partial y} \\
    \end{matrix}
     \right]

     = I +
        \frac{1 + k_1 r^2 + k_2 r^4 + k_3 r^6}{1 + k_4 r^2 + k_5 r^4 + k_6 r^6} I

\] -->

<h1>Mathematical Representation</h1>

<p>Given vector-valued function \(y = f(x)\) and vector \(y_0\), find vector \(x_0\) that satisfies \(f(x_0) = y_0\) .</p>
<p>The solution would be quite clear if \(x = f^{-1}(y)\) is an explicit function.
    However, for the radial tangential model that mentioned above, it is an implicit function.
    Therefore, an numerical method is required to find the solution.
</p>
\[
    x_{n+1} = x_{n} + (x_0 - f(x_{n}))
\]

<p>Denote \(g(x) = x + x_0 - f(x)\), </p>

\[
    x_{n+1} = g(x_n)
\]

<h1>A Controller's Approach</h1>
<p>Recall the the distort function moves a pixel a bit in a specific direction.
    So the undistort function is to find the original coordinate of a distorted point.
    The approach used in this blog is to add the error back to the original input and finally find the
    numerical solution. It sounds like an incremental PID controller.
</p>

<h2>Notations</h2>
<ul>
    <li>\(P_d\): distorted point coordinate </li>
    <li>\(P_n\): point coordinate in n-th iteration</li>
    <li>\(K_I\): coefficient of the integral feedback</li>
    <li>\(f(x)\): distort function </li>
    <li>\(e_n\): error in n-th iteration, \(e_n = P_d - f(P_n)\) </li>
</ul>

<h2>Iteration Equation</h2>
<center>
<figure>
    <img src="/2022/01/21/radial_tangential_numerical_inversion/i_controller.svg" alt="">
    <figcaption>
        Fig.1 - Controller Diagram of the Integral Controller
    </figcaption>

</figure>
</center>

\[
    P_{n+1} = P_n + K_I e_n
\]
\[
    P_{n+1} = P_n + K_I(P_d - f(P_n)) \tag{1-2}
\]

<p>Set \(K_I = 1.0\) to simplify the problem. here is the C++ implementation in <a href="https://github.com/XiaoxingChen/mxm/blob/develop/inc/mxm/model_camera.h#L82" target="_blank" rel="noopener">mxm/model_camera.h</a>: </p>
<pre class="md">
    virtual Matrix<DType> undistort(const Matrix<DType>& homo_pts) const override
    {
        Matrix<DType> ret(homo_pts);
        const size_t iter_max = 5;
        Matrix<DType> tmp;
        for(size_t i = 0; i &lt;iter_max; i++)
        {
            tmp = distort(ret);
            ret = (homo_pts - tmp) + ret;
        }
        return ret;
    }
</pre>

<p>If the controller works, then \( \lim_{n \to \infty} e_n = 0\), i.e. \( \lim_{n \to \infty} P_d = f(P_n) \).  </p>

<h2>Test Result</h2>
<p>The undistort accuracy turned out to be good.</p>
<p style="float: left; font-size: 12pt; text-align: center; width: 45%; margin-right: 1%; margin-bottom: 0.5em;">
    <img src="https://user-images.githubusercontent.com/16934019/152280752-66bcb1b4-06db-4b56-a614-299216a30057.png" style="width: 100%">
    Fig. 2-1: undistorted image</p>
<p style="float: left; font-size: 12pt; text-align: center; width: 45%; margin-right: 1%; margin-bottom: 0.5em;">
    <img src="https://user-images.githubusercontent.com/16934019/152280769-4cfd0a85-db12-4918-a74d-487c7dc88c98.png" style="width: 100%">
    Fig. 2-2: distorted</p>
<p style="clear: both;"></p>

<p style="float: left; font-size: 12pt; text-align: center; width: 45%; margin-right: 1%; margin-bottom: 0.5em;">
    <img src="https://user-images.githubusercontent.com/16934019/152281184-7b7c2c85-68fd-4c9f-9fc9-39df5526fc15.png" style="width: 100%">
    Fig. 2-3: original image</p>
<p style="float: left; font-size: 12pt; text-align: center; width: 45%; margin-right: 1%; margin-bottom: 0.5em;">
    <img src="https://user-images.githubusercontent.com/16934019/152280775-28d3ad23-a6ed-44fc-bb3d-edcef5b7d7ac.png" style="width: 100%">
    Fig. 2-4: diff between original image and distorted image</p>
<p style="clear: both;"></p>


<h1>Know-How and Know-Why</h1>
<p>
    We have found out how the iteration method works, but still don't know why.
    There are several questions left to be answered.
</p>
<ol>
    <li>What's the condition for convergence of the iteration method?</li>
    <li>What's the convergence rate?</li>
    <li>What can we do if the iteration diverged?</li>
</ol>
<p>
    With a great amount of searching on the Internet I have found the
    standard name of the iteration method used by OpenCV is called: Fixed-Point Iteration.
</p>
<h2>Fixed-point Iteration</h2>
<p>In general, an iterative system has the form</p>
\[
    u_{n+1} = g(u_n)
\]
<p>Where \(g: \mathbb{R}^{n} \rightarrow \mathbb{R}^{n} \) is a vector-valued function.</p>
<p>A <i>fixed point</i> or <i>equilibrium</i> of a discrete dynamical system is a vector
\(u^{\star} \in \mathbb{R}^{n}\) such that<sup><a href="#ref3">[3]</a></sup> </p>

\[
    g(u^\star  ) = u^ \star
\]
<p>
    Convergence rate of the iteration: \(\rho(g'(x))\). The method is convergent only if \(\rho(g'(x)) &lt; 1\).
    If \(\rho(g'(x)) > 1\), the procedure diverges. If \(\rho(g'(x)) &lt; 1\) but is close to \(1.0\), convergence is quite slow
    <sup>
        <a href="#ref4">[4]</a>
    </sup>. Here \(\rho(\cdot)\) is the spectral radial of a matrix. \(g'(x)\) is the jacobian matrix of vector-valued function \(g(x)\).
</p>

<h1>References</h1>
<ol class="bib">
    <li id="ref1">
        OpenCV, <a href="https://docs.opencv.org/3.4/da/d54/group__imgproc__transform.html#ga55c716492470bfe86b0ee9bf3a1f0f7e" target="_blank" rel="noopener">undistortPoints</a>
    </li>
    <li id="ref2">
        OpenCV, <a href="https://github.com/opencv/opencv/blob/master/modules/calib3d/src/undistort.dispatch.cpp#L490" target="_blank" rel="noopener">undistort implementation</a>
    </li>
    <li id="ref3">
        Peter J. Olver, <a href="https://www-users.cse.umn.edu/~olver/num_/lne.pdf" target="_blank" rel="noopener">Numerical Solution of Scalar Equations</a>, <i>Numerical Analysis Lecture Notes</i>
    </li>
    <li id="ref4">
        Peter J. Olver, <a href="https://www-users.cse.umn.edu/~olver/num_/lns.pdf" target="_blank" rel="noopener">Vector-Valued Iteration</a>, <i>Numerical Analysis Lecture Notes</i>
    </li>
    <li id="ref5">
        Joe D. Hoffman, <a href="http://freeit.free.fr/Finite%20Element/Hoffman,_Numerical_Methods_for_Engineers&Scientists,2001.pdf#page=155" target="_blank" rel="noopener">Fixed-Point Iteration</a> <i>Numerical Methods for Engineers and Scientists</i>

    </li>

</ol>
</body>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/28/two_reflections_one_rotation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/28/two_reflections_one_rotation/" class="post-title-link" itemprop="url">Two Reflections Form A Single Rotation</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-28 00:00:00" itemprop="dateCreated datePublished" datetime="2021-01-28T00:00:00+08:00">2021-01-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-07-31 22:52:55" itemprop="dateModified" datetime="2021-07-31T22:52:55+08:00">2021-07-31</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2021/01/28/two_reflections_one_rotation/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/01/28/two_reflections_one_rotation/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <head>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
        <style>
            .bib ol { counter-reset: item }
            .bib li { display: block ; counter-increment: item; }
            .bib li:before { content: " ["counter(item)"] "; }
        </style>
</head>
<body>
    <p>
        The proof <sup><a href="https://www.youtube.com/watch?v=Hy2gbdbrJZ8" target="_blank" rel="noopener">[1]</a></sup> of the title will not be present here.
        It is used as a conclusion in this article to solve practical computer graphics and robotics problem.</p>

    <h1>Basic Concepts</h1>
    <h2>Single Rotation</h2>
    <p>A rotation matrix \(R\) in n-dimensional space: \(\{ R \in \mathbb{R}^{n \times n} | RR ^\top = I, \text{det}(R) = 1\}\).
        A single rotation matrix is a rotation matrix \(R\) with only one pair of complex eigenvalues.
    </p>
    <p>A single rotation has only one rotation plane \(B\) and rotation angle \(\theta\).
        The exponential form of a single rotation is \(R = e ^{B \theta}\).   </p>

    <h2>Householder Transform</h2>
    <p>
        Householder transform is a famous orthogonal transform in basic linear algebra.
        For example, QR decomposition use Householder transform to trianglize a matrix.
    </p>
    \[
        P = I - 2 v v ^\top \tag{1-1}
    \]
    <p>Here \(P\) is the <b>Householder matrix</b>, \(I\) is the identity matrix, \(v\) is an n-dimensional unit vector used for reflection. </p>
    <p>There are some properties of \(P\): </p>
    <ol>
        <li>Involutory: \(PP = I\) </li>
        <li>Orthogonal: \(P^\top P  = I\) </li>
        <li>Eigenvalues:
            \( \lambda_i =
            \begin{cases}
                 -1 & \text{i = 1}\\
                 1 & i = 2, \cdots , n\\
            \end{cases}\)
        </li>
        <li>
            Eigenvectors: \(
                \begin{cases}
                    e_i = v & i = 1\\
                    e_i \perp v & i = 2, \cdots , n\\
                \end{cases}
            \)
        </li>
        <li>
            Determinant: \(\text{det}(P) = -1\)
        </li>
    </ol>
    <p>\(\forall x \in \mathbb{R}^{n}, x = c_1 e_1 + c_2 e_2 + \cdots c_n e_n\).
        Then,</p>

    \[
        \begin{align}
            Px &= \lambda_1 c_1 e_1 + \lambda_2 c_2 e_2 + \cdots \lambda_n c_n e_n \\
            &= -c_1 e_1 + c_2 e_2 + \cdots c_n e_n
            \tag{1-2}
        \end{align}
    \]

    <p>Formula (1-2) shows that matrix \(P\) reflect a vector \(x\) along vector \(v\).</p>
    <p>With the definition of <b>reflection</b>, the title of this article can be expressed as follow:
        <blockquote>
            A single rotation \(R\) in plane \(B\) with rotation angle \(\theta\) can be composed by two reflections \(P_1 = I - 2 u u ^\top, P_2 = I - 2 v v ^\top\),
            with \(u\) and \(v\) lie in plane \(B\) and form a angle of \(\frac{\theta}{2}\).
        </blockquote>
    </p>


    <h1>Composition of a Single Rotation</h1>
    <p>An n-dimensional single rotation \(R = e ^{B \theta}\) can be composed by two matrix \(P_1 = I - 2u u ^\top, P_2= I - 2v v ^\top\) </p>
    \[
    \begin{align}
        R &= P_1 P_2 \\
        \cos \frac{\theta}{2}  &= u ^\top v \\
        B &= \text{span}\{u, v\}
    \end{align}

    \]

    <h1>Decomposition of a Single Rotation</h1>

    <p>
        The decomposition from a single rotation to two reflections are not unique.
        Any two reflections \(P_1, P_2\)  with reflect vector \(u, v\) in rotation
        plane \(B\) form a angle \(\theta\) can compose a single rotation.
    </p>
    \[
    \begin{align}
        R &= P_1 P_2 \\
        &= (I - 2u u ^\top) (I - 2v v ^\top) \\
        &= I - 2u u ^\top - 2v v ^\top + 4(u ^\top v) u v ^\top\\
    \end{align}
    \]
    \[
        \frac{R - I}{2} = 2(u ^\top v) u v ^\top - (u u ^\top + v v ^\top) \tag{2-1}
    \]
    <h2>Find the Rotation Angle</h2>
    <p>Because \(\text{tr}(v v ^\top) = \text{tr}(u u ^\top) = 1\), \(\text{tr}(u v ^\top) = u ^\top v\) </p>
    \[
        \text{tr}\left(\frac{R - I}{2}\right)
        = \frac{1}{2} \left(\text{tr}(R) - n\right)
        = 2 (u ^\top v)^2 - 2
    \]
    \[
        \begin{align}
        \cos ^2 \frac{\theta}{2} &= \frac{1}{4} \left(\text{tr}(R) - n\right) + 1 \\
        \sin ^2 \frac{\theta}{2} &= -\frac{1}{4} \left(\text{tr}(R) - n\right)
        \end{align}
    \]
    <p>Because</p>
    \[
        \cos \theta = \cos ^2 \frac{\theta}{2} - \sin ^2 \frac{\theta}{2}
    \]
    \[
        \cos \theta = \frac{\text{tr}(R) - n}{2} + 1 \tag{2-2}
    \]

    <p>It provides a way to calculate rotation angle of a n-dimensional single rotation.
        Specifically, when \(n = 3\), it degenerates to the famous Rodrigous formula.
    </p>

    <h2>Find the Rotation Plane</h2>
    <p>By subtracting (2-1) with its transposition,</p>
    \[
        \frac{R ^\top - I}{2} = 2(u ^\top v) v u ^\top - (u u ^\top + v v ^\top)
    \]
    \[
        \frac{1}{4 (u ^\top v)} (R - R ^\top) = u v ^\top - v u ^\top
        \tag{2-3}
    \]

    <p>
        Denote \(A = u v ^\top - v u ^\top\), \(A ^\top = -A\) and is therefore a skew symmetric matrix.
    </p>
    <blockquote><b>Lemma 1.</b> For vectors \(u \in \mathbb{R}^{n}, v \in \mathbb{R}^{n}\).
        \(u v ^\top - v u ^\top = A\) forms a directional plane \(B\).
        And for any \(x \in \mathbb{R}^{n}\),
        applying \(A\) on \(x\) finds a vector \(y\) in plane \(B\) that \(y \perp x\).
    </blockquote>

    <p>Proof: we use \(y\) and \(u\) to form another plane \(B'\) to see whether plane \(B\) and \(B'\)
        are the same directional plane with different magnitude.</p>
    \[
        A x = y = u v ^\top x - v u ^\top x
    \]
    \[
        \begin{align}
            y u ^\top &= u v ^\top x u ^\top - v u ^\top x u ^\top = (v ^\top x) u u ^\top - (u ^\top x) v u ^\top \\
            u y ^\top &= u x^\top v u ^\top - u x^\top u v ^\top = (x ^\top v) u u ^\top - (x ^\top u) u v ^\top
        \end{align}
    \]
    \[
        y u ^\top + u y ^\top = (u ^\top x) (u v ^\top - v u ^\top) = k A
    \]

    <p>If \(u\) is not perpendicular to \(x\), \(u ^\top x = k \neq 0\).
        Therefore the planes generated by \(y u ^\top + u y ^\top\) and \(u v ^\top - v u ^\top\)
        are the same directional plane with different magnitude. So, vector \(y\) lies in plane \(B\).
    </p>
    <p>Besides:</p>
    \[
        x ^\top y = x ^\top A x
    \]
    <p>Transpose both sides.</p>
    \[
        \begin{align}
            x ^\top y &= (x ^\top A x)^\top \\
            &= -x ^\top A x \\
        \end{align}
    \]
    \[
        x ^\top y = -(x ^\top y) = 0 \implies  x \perp y
    \]

    <p>
        With Lemma1, we can find two vectors in plane \(B\) by applying \(A\) to two vectors that is not perpendicular to
        plane \(B\). An identity matrix \(I\) is consisted of \(n\) orthogonal vectors. By apply \(A\) to \(I\),  \(A I = A\).
        Therefore all column vectors of \(A\) lie in the plane \(B\).
        According to (2-3), \(R - R^\top = 4 u^\top v A = kA\).
        Thus, pick up two columns of none zero vector of matrix \(R - R^\top\),
        one can define the rotation plane of single rotation \(R\) when \(R \neq I\).
    </p>

    <h3>Find the Direction of Rotation Plane</h3>
    <p>
        One rotation angle \(\theta\) and two vectors \(x\) and \(y\)
        are still not enough to define a single rotation.
        The ambiguity is the rotation can be either from \(x\) to \(y\)
        or from \(y\) to \(x\). The rotation direction can be defined as
        follow:
    </p>
    <blockquote class="md">
        Lemma2. Given rotation \(R\) in plane \(B\) and vector \(x \in B\).
        Denote \(y = (R - R^\top)x\). According to Lemma1, \(y\) is also in plane \(B\)
        and \(y \perp x\), then the direction of rotation is from \(x\) to \(y\) with
        rotation angle \(\theta \in [0, \pi)\).
    </blockquote>
    <p>
        Lemma2. will not be proved here. Instead, the following image explains how it works:
    </p>
    <center>
    <figure style="margin-left: auto; margin-right: auto;">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="219px" viewBox="-0.5 -0.5 219 142" style="max-width:100%;max-height:142px;"><defs><style xmlns="http://www.w3.org/1999/xhtml" type="text/css">.MathJax_Preview {color: #888}&#xa;#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}&#xa;#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}&#xa;.MathJax_Error {color: #CC0000; font-style: italic}&#xa;</style><style xmlns="http://www.w3.org/1999/xhtml" type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}&#xa;.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}&#xa;.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}&#xa;.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}&#xa;.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}&#xa;</style><style xmlns="http://www.w3.org/1999/xhtml" type="text/css">.MathJax_SVG_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}&#xa;.MathJax_SVG .MJX-monospace {font-family: monospace}&#xa;.MathJax_SVG .MJX-sans-serif {font-family: sans-serif}&#xa;#MathJax_SVG_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}&#xa;.MathJax_SVG {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}&#xa;.MathJax_SVG * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}&#xa;.MathJax_SVG &gt; div {display: inline-block}&#xa;.mjx-svg-href {fill: blue; stroke: blue}&#xa;.MathJax_SVG_Processing {visibility: hidden; position: absolute; top: 0; left: 0; width: 0; height: 0; overflow: hidden; display: block!important}&#xa;.MathJax_SVG_Processed {display: none!important}&#xa;.MathJax_SVG_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}&#xa;.MathJax_SVG_test.mjx-test-display {display: table!important}&#xa;.MathJax_SVG_test.mjx-test-inline {display: inline!important; margin-right: -1px}&#xa;.MathJax_SVG_test.mjx-test-default {display: block!important; clear: both}&#xa;.MathJax_SVG_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}&#xa;.mjx-test-inline .MathJax_SVG_left_box {display: inline-block; width: 0; float: left}&#xa;.mjx-test-inline .MathJax_SVG_right_box {display: inline-block; width: 0; float: right}&#xa;.mjx-test-display .MathJax_SVG_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}&#xa;.MathJax_SVG .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}&#xa;</style></defs><g><path d="M 110 70 L 203.63 70" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 208.88 70 L 201.88 73.5 L 203.63 70 L 201.88 66.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="170" y="50" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 60px; margin-left: 190px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">\(x\)</div></div></div></foreignObject><text x="190" y="64" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">\(x\)</text></switch></g><path d="M 110 70 L 35.09 13.82" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 30.89 10.67 L 38.59 12.07 L 35.09 13.82 L 34.39 17.67 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 110 70 L 35.09 126.18" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 30.89 129.33 L 34.39 122.33 L 35.09 126.18 L 38.59 127.93 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="0" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 10px; margin-left: 50px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">\(Rx\)</div></div></div></foreignObject><text x="50" y="14" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">\(Rx\)</text></switch></g><path d="M 30 130 L 30 16.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 30 11.12 L 33.5 18.12 L 30 16.37 L 26.5 18.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="0" y="60" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 70px; margin-left: 20px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">\(y\)</div></div></div></foreignObject><text x="20" y="74" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">\(y\)</text></switch></g><path d="M 102.01 63.98 C 104.6 60.55 109.09 59.15 113.17 60.52 C 117.25 61.88 120 65.7 120 70" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="90" y="40" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 50px; margin-left: 120px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">\(\theta\)</div></div></div></foreignObject><text x="120" y="54" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">\(\theta\)</text></switch></g><rect x="90" y="120" width="120" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 130px; margin-left: 150px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">\(y = (R - R^\top)x\)</div></div></div></foreignObject><text x="150" y="134" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">\(y = (R - R^\top)x\)</text></switch></g><rect x="20" y="120" width="70" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 130px; margin-left: 55px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">\(R^\top x\)</div></div></div></foreignObject><text x="55" y="134" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">\(R^\top x\)</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>
    </figure>
    <caption>Figure 2.1</caption>
    </center>
    <p>
        Because \(x\) is a vector in plane \(B\), the N-Dimensional single rotations is equivalent to a rotation in a 2D plane.
        The direction of vector \(y\) is the direction of vector \(x\) with \(90^ \circ\) clockwise rotation if \(\theta \in [0, \pi)\).
        i.e.
    </p>
    \[
        (R - R^\top) x = k \exp \left( \frac{\pi}{2 \theta} \ln(R) \right) x
    \]
    <p>where \(k > 0, k \in \mathbb{R}\).</p>

    <p>
        In summary, to fully define the single rotation plane, one can use the column vector with largest norm in
        matrix \((R - R^\top)\) as vector \(x\), and vector \(y = (R - R^\top)x\).
    </p>



    <h1>The Next Step</h1>
    <p>
        A general rotation in higher dimensional space (\(n > 3\)) may be consists of multiple single rotations.
        A method for decomposing a general rotation to several orthogonal single rotations was proposed <sup><a href="#ref3">[3]</a></sup>.
        By combining those methods, developers may be able to solve higher dimensional geometry problem just as in 3D world.
        Maybe do ray tracing or SLAM in 4D world.
    </p>

    <h1>References</h1>
    <ol class="bib">
        <li id="ref1">
            Mathoma, <a href="https://www.youtube.com/watch?v=Hy2gbdbrJZ8" target="_blank" rel="noopener">Geometric algebra in 2D - Two Reflection is a Rotation</a>, <i>YouTube</i>
        </li>
        <li>
            Wikipedia,<a href="https://en.wikipedia.org/wiki/Householder_transformation" target="_blank" rel="noopener">
            Householder transformation</a>
        </li>
        <li id="ref3">
            Richard, Aurélie, et al. <a href="https://hal.archives-ouvertes.fr/hal-00713697/document" target="_blank" rel="noopener">
            "Decomposition of nD-rotations: classification, properties and algorithm."</a> <i>Graphical models 73.6 (2011): 346-353.</i>
        </li>
        <li>Muphrid,
            <a href="https://math.stackexchange.com/questions/506512/is-there-geometric-interpretation-to-skew-symmetric-coefficient-matrix/506535#506535" target="_blank" rel="noopener">
            "Geometric interpretation to Skew symmetric coefficient matrix."</a> <i>Math stack exchange</i>.
        </li>
    </ol>
</body>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/04/gpu_particle_filter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/04/gpu_particle_filter/" class="post-title-link" itemprop="url">Particle Filter with GPU Implementation</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-04 00:00:00" itemprop="dateCreated datePublished" datetime="2020-10-04T00:00:00+08:00">2020-10-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-28 22:03:42" itemprop="dateModified" datetime="2021-01-28T22:03:42+08:00">2021-01-28</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/10/04/gpu_particle_filter/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/10/04/gpu_particle_filter/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
        <style>
            .bib ol { counter-reset: item }
            .bib li { display: block ; counter-increment: item; }
            .bib li:before { content: " ["counter(item)"] "; }

            code.md{
                background-color:#eee;
                color:deeppink;
                border-radius: 3px;
                border:1px solid #888;
                padding: 2px 2px;
            }
            pre.md{
                background-color:#eee;
                border-radius: 3px;
                border: 1px solid #888 ;
            }
            blockquote.md{
                padding: 0 1em;
                border-left: .25em solid #888;
            }
        </style>

</head>
<body>
    <p>A toy example helps understand OpenCL and particle filter <a href="https://github.com/XiaoxingChen/gpu_particle_filter" target="_blank" rel="noopener">[source code]</a>.</p>
    <h2>Notations</h2>
    <ul>
        <li>state vector: \(\mathrm{x} \in \mathfrak{se}(2)\)</li>
        <li>motion noise: \(\mathrm{w}\)</li>
        <li>motion measurement: \(\mathrm{v}\)</li>
        <li>observation: \(\mathrm{y}\)</li>
        <li>motion model: \(\mathrm{x}_k = f(\mathrm{x}_{k-1}, \mathrm{v}_k, \mathrm{w}_k)\), \(k = 1, \dots, K\)</li>
        <li>observation model: \(\mathrm{y}_k = g(\mathrm{x}_k, \mathrm{n}_k)\), \(k = 0, \dots, K\)</li>
        <li>Number of particles: \(N\)</li>
        <li>Weight of particles: \(\omega\)</li>

    </ul>

    <h2>Estimation</h2>
    <p><b>1. Prediction</b></p>
    <p>Unlike steps in the <a title="State estimation for robotics">textbook</a><sup><a href="" title="http://asrl.utias.utoronto.ca/~tdb/bib/barfoot_ser17.pdf">[1]</a></sup>, I do prediction before sampling particles.</p>

    \[
        \hat{\mathrm{x}}_{k} = f(\mathrm{x}_{k-1}, \mathrm{v}_k, \mathrm{w}_{k})
        \tag{2-1}
    \]

    <p><b>2. Particle sampling </b></p>
    \[
        \left[
        \begin{matrix}
            \check{\mathrm{x}}_{k,m} \\
            \mathrm{w}_{k,m}
        \end{matrix}
        \right]
        \leftarrow

        p(\hat{\mathrm{x}}_{k}) p(\mathrm{w}_{k-1})
        \tag{2-2}
    \]

    <p><b>3. Likelihood calculation</b></p>
    <p>Here I use the likelihood between the simulated LiDAR measurement to actual LiDAR sensor data as the particle weight.</p>
    \[
        \omega_{k,m} \propto p(y_k | \check{\mathrm{x}}_{k,m}) = p(y_k | \check{\mathrm{y}}_{k,m})
        \tag{2-3}
    \]
    <p>LiDAR measurement model: </p>
    \[
        p(y_k|\check{\mathrm{y}}_{k,m}) =
        \begin{cases}
        \text{PDF}(y_k - \check{\mathrm{y}}_{k,m}) && \text{ if } \ y_k, \check{\mathrm{y}}_{k,m} \le L_{max}), \\
        1 - \text{CDF}(y_k - \check{\mathrm{y}}_{k,m}) && \text{ if } \ y_k > L_{max} \text{ or } \check{\mathrm{y}}_{k,m} > L_{max}, \\
        \epsilon && \text{else}
        \end{cases}
        \tag{2-4}
    \]

    <p>
        \(L_{max}\) means the maximum measure distance of the LiDAR sensor.
        \(\text{PDF}\) is the probabilistic distribution function of the sensor model,
        a gaussian model is used in this project.
        \(\text{CDF}\) is the cumulative distribution function of the sensor model.
        \(epsilon\) is a constant small value in code implementation which minimizes the impact of
        overranged LiDAR beam.
    </p>

    <p><b>4. Resampling</b></p>
    <p>I use the method in this paper<sup><a href="https://cse.sc.edu/~terejanu/files/tutorialMC.pdf" target="_blank" rel="noopener">[2]</a></sup> to do resampling.
    <a href="https://leetcode.com/problems/random-pick-with-weight/" target="_blank" rel="noopener">Leetcode 528</a> is also helpful for understanding.</p>

    <h2>Parallelization</h2>
    <p>
        In this project, I use line segments to represent objects in map without any acceleration structure.
        For a single line LiDAR with resolution \(H\), working in a map with \(S\) segments, a particle filter with \(N\) particles has to
        calculate line intersection for with complexity \(O(H \times S \times N)\). While those calculations are totally independent,
        it is available to do parallelization. The determination of line segment intersection is presented here<sup><a href="https://xiaoxingchen.github.io/2018/10/13/planar_line_segment_intersection/" target="_blank" rel="noopener">[4]</a></sup>.
    </p>
    <p>
        After eliminating the LiDAR beams that never intersect with objects, the rest beams' measure distances were calculated.
        <a href="https://en.wikipedia.org/wiki/Reduction_Operator" target="_blank" rel="noopener">Parallel reduction</a> was used to find the "close hit" among all intersections of a single LiDAR beam.
    </p>

    <p>
        Besides, the likelihood between simulation and actual measurement are also calculated in GPU.
        To avoid float point overflow, the calculation was done in logarithmic space.
        For there is no built-in cumulative gaussian function in OpenCL, it is <a href="https://en.wikipedia.org/wiki/Normal_distribution#Cumulative_distribution_function" target="_blank" rel="noopener">approximated by error function</a>:
    </p>
    \[
        \text{CDF}(x) = \frac{1}{2}
        \left[
        1 + \text(erf)(\frac{x - \mu}{\sigma \sqrt 2})
        \right]
    \]

    <h2>Experiments</h2>
    <h3>Ice World</h3>
    <figure>
        <img src="https://user-images.githubusercontent.com/16934019/80937927-a1e1c880-8e09-11ea-99cb-6fa34e88f895.gif" style="width:70%">
        <figcaption>
            Fig.1 - LiDAR resolution: 32, LiDAR measure distance: 50 meters, particle number: 512.
        </figcaption>
    </figure>

    <h3>Featureless Corridor</h3>
    <figure>
        <img src="https://user-images.githubusercontent.com/16934019/80937931-aa3a0380-8e09-11ea-9937-49a308e7e95d.gif" style="width:70%">
        <figcaption>
            Fig.2 - LiDAR measure distance: 20 meters. As shown in the image, particle filter can easily lost in feature less scenario.
            The covariance in longitudinal direction increase drastically while in lateral direction it is till stable.
            The localization converge immediately when LiDAR beam detects corner.
        </figcaption>
    </figure>


    <h3>Circular Corridor</h3>
    <figure>
        <img src="https://user-images.githubusercontent.com/16934019/80937934-ac03c700-8e09-11ea-95ee-2300c933b5f3.gif" style="width:70%">
        <figcaption>
            Fig.3 - The localization is stable the LiDAR beam matches well to the wall. However the estimated position deviated from the actual position.
            In this situation, one dimension of the localization is unobservable(need confirm).
        </figcaption>
    </figure>
    <h2>References</h2>
    <p>
        <ol class="bib">
            <li>
                Barfoot, Timothy D.
            <cite>
                <a href="http://asrl.utias.utoronto.ca/~tdb/bib/barfoot_ser17.pdf" target="_blank" rel="noopener">"State estimation for robotics."</a>
            </cite>
                Cambridge University Press, 2017.
            </li>
            <li>
            Terejanu, Gabriel A.
            <cite>
                <a href="https://cse.sc.edu/~terejanu/files/tutorialMC.pdf" target="_blank" rel="noopener">"Tutorial on Monte Carlo Techniques." </a>
            </cite>
                Department of Computer Science and Engineering. University at Buffalo (2009).
            </li>
            <li>
                Atsushi, Sakai.
                <a href="https://github.com/AtsushiSakai/PythonRobotics/blob/master/Localization/particle_filter/particle_filter.py" target="_blank" rel="noopener">"PythonRobotics."</a>
            </li>
            <li>
                Xiaoxing, Chen.
                <a href="https://xiaoxingchen.github.io/2018/10/13/planar_line_segment_intersection/" target="_blank" rel="noopener">"Determine Intersection of Two Planar Line Segments"</a>
            </li>
        </ol>
    </p>
</body>
</html>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/07/least_l1_norm_problem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/07/least_l1_norm_problem/" class="post-title-link" itemprop="url">Least L1-norm Problem</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-07 00:00:00" itemprop="dateCreated datePublished" datetime="2020-05-07T00:00:00+08:00">2020-05-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-04 20:22:59" itemprop="dateModified" datetime="2020-10-04T20:22:59+08:00">2020-10-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/05/07/least_l1_norm_problem/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/05/07/least_l1_norm_problem/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <head>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
        <style>
            .bib ol { counter-reset: item }
            .bib li { display: block ; counter-increment: item; }
            .bib li:before { content: " ["counter(item)"] "; }
        </style>
</head>
<body>
    <h2>Background</h2>
    <p>This article came from a Leetcode problem: <a href="https://leetcode.com/problems/minimum-moves-to-equal-array-elements-ii/" target="_blank" rel="noopener">462. Minimum Moves to Equal Array Elements II</a>.
        For the sake of reading experience, I paste the problem description here: 
    </p>
    <blockquote>
        <p>
            Given a <b>non-empty</b> integer array, 
            find the minimum number of moves required to make all array elements equal, 
            where a move is incrementing a selected element by 1 or decrementing a selected element by 1.
        </p>
        <p>You may assume the array's length is at most 10,000.</p>
        <p><b>Example:</b></p>
    
        <pre><b>Input:</b>
        [1,2,3]
        
        <b>Output:</b>
        2
        
        <b>Explanation:</b>
        Only two moves are needed (remember each move increments or decrements one element):
        
        [1,2,3]  =&gt;  [2,2,3]  =&gt;  [2,2,2]
        </pre>
    </blockquote>
    <p>
        My first intuition was to sum the distances between each element and the mean(average) of the list, which failed to pass the 
        test. Here we discuss the problem in a mathematical way.
    </p>

    <h2>Problem Statement</h2>
    <p>The description:</p>
    <blockquote>
        find the minimum number of moves required to make all array elements equal.
    </blockquote>
    <p>means we need to find a \(m\) which satisfies:</p>
    \[
        \arg\min_m \sum_{i=1}^n |x_i - m|
        \tag{1-1}
    \]
    <p>\(x\) is an \(n\) dimensional vector.</p>
    <p>
        In other words, the \(m\) we need is to minimize the L1-norm of the residual. 
        While the average of a list minimize the L2-norm of the residual. 
    </p>
    <h2>Derivation</h2>
    <p>In order to find \(m\), we can borrow the idea of how the average \(\mu\) was found:</p>
    \[
        \arg\min_\mu (x - \mu)^\top(x - \mu)
        \tag{2-1}
    \]

    <p>The minimum can be found by setting its derivative to 0: </p>
    \[
        \frac{\text{d}}{\text{d}\mu} (x - \mu)^\top(x - \mu) = \frac{\text{d}}{\text{d}\mu} (x^\top x - 2\mu\sum_{i=1}^n x_i + n\mu ^2) = 0
        \tag{2-2}
    \]
    \[
        2n\mu - 2\sum_{i=1}^n x_i = 0
    \]
    \[
        \mu = \frac{\sum_{i=1}^n x_i}{n} \tag{2-3}
    \]

    <p>We write formulation (1-1) as:</p>
    \[
        \arg\min_m \sum_{i=1}^n \sqrt{(x_i - m)^2}
        \tag{2-4}
    \]
    <p>Set the derivative to 0:</p>
    \[
        \frac{\text{d}}{\text{d}m} \sum_{i=1}^n \sqrt{(x_i - m)^2} = \sum_{i=1}^n \frac{x_i - m}{\sqrt{(x_i - m)^2}} \\
        = \sum_{i=1}^n \text{sign} (x_i - m) = 0 \tag{2-5}
    \]
    <p>Formula (2-5) indicates that when \(m\) lies on the coordinate 
        such that the number of \(x_i\) greater than \(m\) equals to the number of \(x_i\) less than \(m\), 
        \(m\) minimizes the L1-norm of the residual. It is worth noting that there are more than one solution.
        The median of the vector \(x\) can be a solution.
    </p>

    <figure>
        <img src="/2020/05/07/least_l1_norm_problem/m_l2_norm.svg" style="width:100%">
        <figcaption>
            Given 10 dimensional vector \(x\), plot \(m\) with respect to the L2-norm of residual.
            It can be seen that the \(m\) minimizing L1-norm is not unique. 
            <a href="/2020/05/07/least_l1_norm_problem/main.py">
            [source code]</a>
        </figcaption>
    </figure>

    <h2>Summary</h2>    
    <p>A clean solution of the leetcode problem can be:</p>
    <pre>
    class Solution:
        def minMoves2(self, nums: List[int]) -> int:
            nums.sort()
            m = nums[len(nums) // 2]
            return sum([abs(n - m) for n in nums])
    </pre>

    
    <h2>References</h2>
    <ol class="bib">
        <li>log0,<a href="http://www.chioka.in/differences-between-the-l1-norm-and-the-l2-norm-least-absolute-deviations-and-least-squares/" target="_blank" rel="noopener">
            Differences between the L1-norm and the L2-norm (Least Absolute Deviations and Least Squares)</a>
        </li>
        <li>
            hattenn, Royi<a href="https://math.stackexchange.com/questions/113270/the-median-minimizes-the-sum-of-absolute-deviations-the-l-1-norm" target="_blank" rel="noopener">
            The Median Minimizes the Sum of Absolute Deviations (The L1 Norm)</a> StackExchange
        </li>
    </ol>
</body>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/14/essential_mat_by_optimization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/14/essential_mat_by_optimization/" class="post-title-link" itemprop="url">Solve Epipolar Constraint by Optimization over Unit Sphere Manifold</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-14 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-14T00:00:00+08:00">2020-03-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-02 23:21:33" itemprop="dateModified" datetime="2020-07-02T23:21:33+08:00">2020-07-02</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/03/14/essential_mat_by_optimization/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/03/14/essential_mat_by_optimization/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <head>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
        <style>
            .bib ol { counter-reset: item }
            .bib li { display: block ; counter-increment: item; }
            .bib li:before { content: " ["counter(item)"] "; }
        </style>
</head>
<body>
    <h1>Motivation</h1>
    <p>
        While estimating the transform between two images, one has to solve the Essential Matrix according to Epipolar Constraint:
    </p>
    \[
        x_2^\top E x_1 = 0 
        \tag{1-1}
    \]
    <p>Five-point-algorithm and eight-point-algorithm are both applicable. 
        Here I take eight-point algorithm as example. The essential matrix is vectorized,
        and equation (1-1) is transformed to a homogeneous equation in form \(Ax = 0\). 
        The homogeneous equation can be solved by SVD, and the essential matrix will be recovered from vector \(x\).
    </p>
    <p>
        However, according to the definition of essential matrix:
    </p>
    \[
    E = \{ S R | S = t^\wedge \in \mathfrak{so}(3), R \in SO(3)\} \tag{1-2}
    \]
    <p>
        Singular values of a essential matrix are \([1,1,0]\) <sup><a href="/2020/01/20/essential_mat_sig_val">[1]</a></sup>.
        In order to make the solution "essential", a general solution<sup>[2]</sup> is to SVD the result and replace its singular value with \([1,1,0]\).
        The matrix \(\hat E\) is the projection of matrix \(E\) on essential manifold. 
        By decomposing motion from essential matrix, one will get four solutions. 
        Only one of the four solutions is available, whose feature points have position depth in camera.
        Finally, the rotation matrix and translation vector are recovered.
    </p>
    \[
        \hat E = U_E \text{diag}(1,1,0)  V_E^\top
        \tag{1-3}
    \]
    <p>
        In this article, I am going to implement an optimization based method to find the essential matrix. 
    </p>
    <h1>Problem Formulation</h1>
    <h2>Parameterization</h2>
    <p>
        Few papers talk about properties of essential manifold.
        Let's see what will happen if I solve the problem with only constraint the rotation matrix.
        I parameterize the essential matrix to a 6-dimensional vector: 3-dimensional translation vector and 3-dimension rotation.
        But it was denied after I found the equation will always converge at the point where translation vector \(t = [0,  0,  0]^\top\).
        This is where "pure rotation" happens, the constraint "degenerated". 
        Therefore, I finally added a constraint \(\|t\| = 1\), to restrict the translation vector on a unit sphere.
        If I can turn the unit sphere manifold to a Lie Group, the the solution can be solve as what one do to the rotation part.
        Unluckily, the answer was "NO": 
        <a href="https://math.stackexchange.com/questions/3481290/can-every-manifold-be-turned-into-a-lie-group" target="_blank" rel="noopener">
            \(S^2\) manifold cannot be given a Lie Group structure</a>.
    </p>
    <p>
        Anyway, the idea of constrained optimization is to iterate the state vector without breaking the constraint.
        The translation vector on unit sphere has degree of 2, the essential matrix was then vectorized to \(E = [\tau_x, \tau_y, \psi_x, \psi_y, \psi_z]^\top\). 
        Every step I calculate the jacobian of the translation vector in two orthogonal directions. 
        In order to preserve the incremental direction, the translation vector is stored in a orthonormal matrix \(T = [t_x, t_y, t_z], T \in SO(3)\).
        The first two columns of the matrix \(t_x, t_y\) indicates the incremental directions, the last column \(t_z\) is the vector itself.
    </p>
    <h2>Cost Function</h2>
    <p>Residual: </p>
    \[
        f(x) = x_1^\top t_z^\wedge R x_2 \tag{2-1}
    \]

    <p>The problem then comes to:</p>
    \[
        \text{arg}\ \text{min} F(t_z, R) = \frac{1}{2} \sum_{i = 1} ^ n \|f(t_z, R)\|^2 
        = \frac{1}{2} \sum_{i = 1} ^ n 
        \left( 
            (x_{1,i}^\top t_z^\wedge R x_{2,i})^\top (x_{1,i}^\top t_z^\wedge R x_{2,i}) 
        \right)
        \tag{2-2}
    \]

    <h2>Jacobian</h2>
    <p>I use numerical method to calculate the jacobian.</p>
    \[
        J = 
        \left[
        \begin{matrix}
        \frac{\partial f}{\partial \tau_x} &
        \frac{\partial f}{\partial \tau_y} &
        \frac{\partial f}{\partial \psi_x} &
        \frac{\partial f}{\partial \psi_y} &
        \frac{\partial f}{\partial \psi_z}
        \end{matrix}
        \right]
        \tag{2-3}
    \]
    <h2>Update</h2>
    \[
        \begin{cases}
            \Delta \tau = [\Delta \tau_x, \Delta \tau_y, 0]^\top\\
            T_k = \text{exp} (\Delta \tau ^ \wedge) T_{k-1} \\
            t_{z,k} = T_{k[:,3]} \\ 
            R_k = \text{exp} (\Delta \psi ^ \wedge) R_{k-1}
        \end{cases}
        \tag{2-4}
    \]

    <h1>Simulation</h1>
    <p>
        Two cameras were set at position \((0.5, -0.8, 0.5)m\) and \((0.6, -0.8, 0.5)m\), 
        their orientations were presented in rotation vectors: \((-\frac{\pi}{2}, 0, 0)rad\), \((-\frac{\pi}{2}, 0.1, 0)rad\).
        Totally 60 points were generated.
    </p>

    <figure>
        <img src="/2020/03/14/essential_mat_by_optimization/3d_view.svg" style="width:70%">
        <figcaption>
            Fig.1 - Generate point cloud in 3D space, the red arrows indicate the pose of cameras. 
        </figcaption>
        
    </figure>
        
    <figure>
        <img src="/2020/03/14/essential_mat_by_optimization/essential_by_gn.svg" style="width:100%">
        <figcaption>
            Fig.2 - Project points to normalized camera coordinate. 
            The point IDs are known to algorithm so that there is no outliers in matching.
            <a href="https://github.com/XiaoxingChen/pyproj/blob/master/epipolar_geometry/essential_by_gn.py" target="_blank" rel="noopener">
            [source code]</a>
        </figcaption>
    </figure>

    <p>The Gauss-Newton method was used to calculate the update. 
        Given initial value \(t = (\frac{1}{\sqrt{2}}, \frac{1}{\sqrt{2}}, 0)\), \(\psi = (0, -0.1, 0)\)
        The cost converged within 10 iterations.
    </p>
    <pre><code class="language-log">
        it: 0, cost: 32027813.76362674
        it: 1, cost: 77838.5880822376
        it: 2, cost: 6281.828095169881
        it: 3, cost: 112.93046933952343
        it: 4, cost: 6.927671506086043
        it: 5, cost: 1.0246290629301655e-07
        it: 6, cost: 1.2263197696799394e-15
        it: 7, cost: 3.9916308419887783e-25
        it: 8, cost: 4.27369517787316e-25
        it: 9, cost: 2.6192914664154937e-25
        t: [ 9.9984608e-01 -7.6998377e-17 -1.7341515e-16], r: [-0.0011568  0.0636558  0.0636558]
        groundtruth: t01: [0.1 0.  0. ], r01: [-0.0011568  0.0636558  0.0636558]
    </code></pre>

    <figure>
        <img src="/2020/03/14/essential_mat_by_optimization/viz_iteration.svg" style="width:70%">
        <figcaption align='center'>
            Fig.3 - Cost in iteration.
        </figcaption>
    </figure>

    <h1>Conclusion</h1>
    <p>
        Compared with eight-point-algorithm, there is no "linear space to manifold" projection required in optimization based method.
        Every iteration was restricted on manifold. Besides, optimization method does not need essential matrix decomposition.
        The optimization targets are rotation and translation direction.
        However, with different iteration initial values, the method may converge to any of the four 
        possible solutions. Developer has to recover four solutions from the converged one and verify all of them.
        The accuracy of both methods are reliable, errors come from numerical computation.
    </p>

    <h1>References</h1>
    <ol class="bib">
        <li>
            Xiaoxing.
            <cite>
                <a href="/2020/01/20/essential_mat_sig_val">
                    Singular Values of Essential Matrix
                </a>
            </cite>
        </li>
        <li>
            Zhang, Zhengyou. 
            <cite>
                "Determining the epipolar geometry and its uncertainty: A review."
            </cite>
            International journal of computer vision 27.2 (1998): 161-195.
        </li>
    </ol>
    
</body>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/02/bspline_in_so3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/02/bspline_in_so3/" class="post-title-link" itemprop="url">B-Spline in Space I - Euclidean Space</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-02 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-02T00:00:00+08:00">2020-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-04 20:27:43" itemprop="dateModified" datetime="2020-10-04T20:27:43+08:00">2020-10-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/03/02/bspline_in_so3/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/03/02/bspline_in_so3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <head>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
        <style>
            .bib ol { counter-reset: item }
            .bib li { display: block ; counter-increment: item; }
            .bib li:before { content: " ["counter(item)"] "; }
        </style>
</head>

<body>
    <h2>Motivation</h2>
    <p>In a robot system, tens of sensors collecting data in different frequencies and phases.
        When intermediate values between samples are required, linear interpolation can be used to approximate these values according
        to their surrounding samples. In some cases, however, linear interpolation is not qualified due to its 
        lack of continuity in high order derivatives. 
    </p>
    <p>
        Moreover, in robotics, computer graphics and computer vision, physical values are not only expressed in Euclidean Space.
        The orientation of a digital object, the pose of a automatic robot, are described by Quaternion or Lie Group. 
        Some of the readers may have heard about Quaternion SLERP (Spherical Linear Interpolation), which is a general 
        method used in Quaternion interpolation. But SLERP only keeps the intermediate quaternion unit, 
        the derivative continuity before and after a knot is not guaranteed. 
    </p>
    <p>
        With but not limited to the reasons above, B-Spline is widely used in industry and research. 
        Here is a introduction to the principle of B-Spline, both in Euclidean Space and Lie Group.
    </p>
    <h2>Terminologies of B-Spline</h2>
    <table style="min-width: 6in;">
        <col width="20%">
        <col width="15%">
        <col width="65%">
        <tr>
            <th>Terminologies</th>
            <th>Notation</th>
            <th>Explanation</th>
        </tr>
        <tr>
            <td>Independent Variable</td>
            <td>\(t\)</td>
            <td>In state estimation, the independent variable is time \(t\).</td>
        </tr>
        <tr>
            <td>Order</td>
            <td>\(n\)</td>
            <td>Same as the order of final polynomial, the highest exponent.For instance, \(f(x) = 3x^3\) has an order of 4.</td>
        </tr>
        <tr>
            <td>Degree</td>
            <td>\(p\)</td>
            <td>Same as the degree of final polynomial, the highest exponent.For instance, \(f(x) = 3x^3\) has a degree of 3.</td>
        </tr>
        <tr>
            <td>Segment Index</td>
            <td>\(i\)</td>
            <td>A B-Spline is combined with piecewise polynomial, each piece is a segment.</td>
        </tr>
        <tr>
            <td>Knot Vector</td>
            <td>\(k\)</td>
            <td>
                The connect knot, or joint, between every piece of polynomial segment.
                Knot vector lies in the axis of independent variable \(t\).
            </td>
        </tr>
        <tr>
            <td>Basis Function</td>
            <td>\(B_{i,p}(t)\)</td>
            <td>In the expression, \(i\) is the index of polynomial segment, \(p\) is the degree of the basis function.</td>
        </tr>
        <tr>
            <td>Control Points</td>
            <td>\(C_i\)</td>
            <td>Also named as coefficients. Control points are used to describe the weight of each piece of polynomial segment.</td>
        </tr>
    </table>
    <h2>Intuitive Understanding from Figures</h2>

    <figure>
        <img src="/2020/03/02/bspline_in_so3/viz_basis_function.svg" style="width:100%">
        <figcaption>
            Fig.1 - Iterative composition of basis functions. Each segment of basis function \(B_{i,p}(t)\) is composed 
            by its adjacent basis functions in lower degree, which are \(B_{i,p-1}(t)\) and \(B_{i + 1,p-1}(t)\). 
            While basis functions in degree 0 are unit square wave signals.
            <a href="/2020/03/02/bspline_in_so3/viz_basis_function.py">
            [source code]</a>
        </figcaption>
    </figure>

    <figure>
        <img src="/2020/03/02/bspline_in_so3/viz_bspline.svg" style="width:100%">
        <figcaption>
            Fig.2 - The point \(P_{0,2}\) of basis function \(B_{0,2}(t)\) (degree 2 and segment 0), is evaluated by 
            the weighted combination of \(B_{0,1}(t)\) and \(B_{1,1}(t)\). The <b>weight</b> of each component is 
            defined by the distance between \(P_{0,2}\) and its correspondent knot points. 
            As shown in the figure, the knot vector is \([0, 3, 6, 9]^\top\).
            <a href="/2020/03/02/bspline_in_so3/viz_bspline.py">
            [source code]</a>
        </figcaption>
    </figure>

    <figure>
        <img src="/2020/03/02/bspline_in_so3/viz_ctrlpt.svg" style="width:100%">
        <figcaption>
            Fig.3 - A B-Spline with degree 2, named \(S_2(t)\) is generated by weighted combinations of all its 
            basis functions. The weight comes from control points, which are \([1.2, 0.8, 1.1, 1.2, 1.1]\) in the figure.
            The brown dash lines show how control point affect the weight of basis function,
            these lines finally compose the brown spline.
            The knot vector is \([0, 1, 2, 3, 4, 5, 6, 7]^\top\).
            <a href="/2020/03/02/bspline_in_so3/viz_ctrlpt.py">
            [source code]</a>
        </figcaption>
    </figure>
    <h2>Cox-de Boor Recursion Formula</h2>
    <p>A mathematical representation of B-Spline is necessary after the intuitive concept.</p>
    <p>
        Let \(K\) be a set of \(m\) non-decreasing numbers, \(k_0 \le k_1 \le \cdots \le k_{m-1} \). 
        The \(k_i\)s are called knots, the set \(K\) the knot vector, 
        and the half-open interval \([k_i, k_{i+1})\) the i-th knot span. 
        Note that since some \(k_i\)s may be equal, some knot spans may not exist. 
        If the knots are equally spaced (i.e., \(k_{i+1} - k_i\) is a constant for \((0 \le i \le m - 1)\), 
        the knot vector or the knot sequence is said uniform; otherwise, it is non-uniform<sup>[1]</sup>.
    </p>
    <p>
        The i-th B-spline basis function of degree \(p\), written as \(B_{i,p}(t)\), is defined recursively as follows:
    </p>
    \[
        B_{i,0}(t) = 
        \begin{cases}
        1 & \text{if} \ \ t_i \le t < t_{i+1} \\
        0 & \text{otherwise}
        \end{cases}
        \tag{2-1}
    \]

    \[
        B_{i,p}(t) = 
        \frac{t - t_i}{t_{i+p} - t_i} B_{i,p-1}(t) + 
        \frac{t_{i+p+1} - t}{t_{i+p+1} - t_{i+1}} B_{i+1,p-1}(t)
        \tag{2-2}
    \]
    
    <h2>References</h2>
    <ol class="bib">
        <li>Shene,<a href="https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/spline/B-spline/bspline-basis.html" target="_blank" rel="noopener">
            B-spline Basis Functions: Definition</a>
        </li>
        <li>Kim, M.J., Kim, M.S. and Shin, S.Y., 1995, September.
            <cite>
                <a href="http://graphics.cs.cmu.edu/nsp/course/15-464/Fall05/papers/kimKimShin.pdf" target="_blank" rel="noopener">
                    A general construction scheme for unit quaternion curves with simple high order derivatives.        
                </a>
            </cite>
            In Proceedings of the 22nd annual conference on Computer graphics and interactive techniques (pp. 369-376).
        </li>
        <li>
            Qin, Kaihuai, 
            <cite>
                <a href="/2020/03/02/bspline_in_so3/general_matrix_representation_for_bsplines.pdf">
                    General matrix representations for B-splines
                </a>
            </cite>
                , The Visual Computer (2000) 16:177–186
        </li>
    </ol>

      
</body>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/29/why_here/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/29/why_here/" class="post-title-link" itemprop="url">Why Here</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-29 16:27:00" itemprop="dateCreated datePublished" datetime="2020-02-29T16:27:00+08:00">2020-02-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-17 22:03:08" itemprop="dateModified" datetime="2020-03-17T22:03:08+08:00">2020-03-17</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/02/29/why_here/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/02/29/why_here/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
<p>
The original blog locates at 
<a href="https://blog.csdn.net/buchunjiedexin" target="_blank" rel="noopener">CSDN XiaoxingChen's Blog</a>.
Due to its terrible support to mathematical equation and version control, I turned to 
log my daily thinkings and notes in private git repositories.
So far I start to make some of the contents public, here is the new site for them.
</p>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/20/essential_mat_sig_val/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/20/essential_mat_sig_val/" class="post-title-link" itemprop="url">Singular Values of Essential Matrix</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-20 17:13:14" itemprop="dateCreated datePublished" datetime="2020-01-20T17:13:14+08:00">2020-01-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-29 12:22:16" itemprop="dateModified" datetime="2020-03-29T12:22:16+08:00">2020-03-29</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/01/20/essential_mat_sig_val/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/20/essential_mat_sig_val/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <head>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
        <style>
            .bib ol { counter-reset: item }
            .bib li { display: block ; counter-increment: item; }
            .bib li:before { content: " ["counter(item)"] "; }
        </style>
</head>

<body>



<p>Essential matrix is not new to anybody being familiar with Epipolar Geometry. Here is the famous epipolar constraint: </p>
\[
    x_2^\top E x_1 = 0 
\]
<p>
    Recall that when the essential matrix is obtained by 8-point algorithm, 
    one has to decompose the result with SVD to make its third singular value 0 and the other 
    two singular values equal. Here is a short derivation of this property of essential matrix.
</p>

<p>According to the definition of essential matrix: </p>
\[
 E = \{ S R | S = t^\wedge \in \mathfrak{so}(3), R \in SO(3)\} \tag{1-1}
\] 

<p>
    According to the definition of SVD, a singular value \(\sigma\) of a matrix A, 
    equals to the square root of correspondent eigenvalue \(\lambda\) of matrix \(A^\top A\):
</p>
\[
   \sigma_{A,i} = \sqrt{\lambda_{A^\top A,i}} \tag{1-2}
 \]
<p>Meanwhile,</p>
 \[
    E^\top E = R^\top S^\top S R = -R^\top (t^\wedge)^2 R \tag{1-3}
 \]
 <p>According to the property of askew-symmetric matrix:</p>
 \[
    (t^\wedge)^2 = \|t\|^2 I - t t^\top \tag{1-4}
 \]
 <p>The first term is a scalar matrix with three equal eigenvalues \(\|t\|^2\)</p>
 <p>The second term \(t t^\top\) is a symmetric matrix, which is therefore semi-positive definite.
    It can be diagonalized<sup><a href="/2020/01/20/mat_generated_by_outer_product">[1]</a></sup>:
 </p>
 \[
    t t^\top = \|t\|^2 R_t^\top diag(1, 0, 0) R_t \tag{1-5}
 \]

 <p>Thus, equation (1-3) becomes:</p>
 \[
    E^\top E = \|t\|^2 R^\top R_t^\top ( I - diag(1, 0, 0)) R_t R 
    
 \]
 \[
    = \|t\|^2 (R_t R )^\top diag(1, 1, 0) (R_t R) 
    \tag{1-6}
 \]

 <p>Therefore, eigenvalues of \(E^\top E\) are: \(\|t\|^2 (1, 1, 0)\).</p>
 <p>Finally, according to (1-3), singular values of essential matrix \(E\) are: \(\|t\|(1, 1, 0)\).</p>

 <br>

 <h2>References</h2>
 <ol class="bib">
    <li>Xiaoxing. <a href="/2020/01/20/mat_generated_by_outer_product"><cite>Property of Matrix Generated by Outer Product</cite></a></li>
 </ol>
</body>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/19/mat_generated_by_outer_product/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/19/mat_generated_by_outer_product/" class="post-title-link" itemprop="url">Property of Matrix Generated by Outer Product</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-19 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-19T00:00:00+08:00">2020-01-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-28 22:02:51" itemprop="dateModified" datetime="2021-01-28T22:02:51+08:00">2021-01-28</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/01/19/mat_generated_by_outer_product/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/19/mat_generated_by_outer_product/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
<head>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
</head>
<body>
<p>Given vector \(a\) with length \(m\) and \(b\) with length \(n\), the outer product of them defined as:</p>
\[
    a b^\top = C \tag{1-1}
\]
<p>While matrix \(C\) has dimension \(m \times n\).</p>
<p>Here is a brief discussion of the property of matric \(C\)</p>

<h2>Special Case: \(a = b\)</h2>
<p>Then we have:</p>
\[
    A = a a^\top \tag{1-2}
\]

\[
    A =
    \left[
    \begin{matrix}
    a_1 a & a_2 a & \cdots & a_n a
    \end{matrix}
    \right]
    =
    \left[
    \begin{matrix}
    a_1 a^\top \\
    a_2 a^\top \\
    \vdots \\
    a_n a^\top
    \end{matrix}
    \right]
    \tag{1-3}

\]

\[
    A =
    \left[
    \begin{matrix}
    a_1 a_1 & a_1 a_2 & \cdots & a_1 a_n \\
    a_2 a_1 & a_2 a_2 & \cdots & a_2 a_n \\
    \vdots & \vdots & \ddots & \vdots \\
    a_n a_1 & a_n a_2 & \cdots & a_n a_n \\
    \end{matrix}
    \right]
    \tag{1-4}
\]
<p>Here are several properties of matrix A:</p>
<ol>
    <li>\(det(A) = 0\)</li>
    <li>\(trace(A) = \|a\|^2\)</li>
    <li>\(rank(A) = 1\)</li>
    <li>Eigenvalues of \(A\) are: \([\|a\|^2, 0, \cdots, 0]\)</li>
</ol>
<p>
    According to equation (1-3), all column or row vectors of matrix \(A\) are linear correlated, so its rank is 1.
    Meanwhile, \(A\) is a symmetrical semi positive definite matrix, \(trace(A) = \Sigma_{i = 1}^n \lambda_i\), \(\lambda\) is the eigenvalue  of \(A\).
    Because \(rank(A) = 1\), only the first eigenvalue of \(A\) is not zero. Therefore, \(trace(A) = \lambda_1 = \|a\|^2\).
</p>


<h2>General Case</h2>
\[
    a b^\top = C \tag{2-1}
\]

<p>Properties of matrix C:</p>
<ol>
    <li>Denote \(k = \text{min}(m,n)\)</li>
    <li>\(\text{det}(C) = 0\)</li>
    <li>\(\text{trace}(C) = a[0:k]^\top b[0:k] \)</li>
    <li>\(\text{rank}(C) = 1\)</li>
    <li>Singular values of \(C\) are: \([\|a\|\|b\|, 0, \cdots, 0]\)</li>
</ol>

<h2>Decomposition</h2>
<p>Given a 1-rank matrix \(A \in \mathbb{R}^{m \times n}\), it can be decomposed to:  </p>
\[
    A = u v ^\top
\]
\[
    u = k
    \left[
    \begin{matrix}
        a_{11} \\
        a_{21} \\
        \vdots \\
        a_{m1} \\
    \end{matrix}
     \right]

\qquad

    v ^\top = \frac{1}{k a _{11}}
    \left[
    \begin{matrix}
        a_{11} &
        a_{12} &
        \cdots &
        a_{1n}
    \end{matrix}
     \right]

    \quad
    (k \neq 0)
    \tag{2-2}
\]

<p>Because of the existence of \(k\), the decomposition is not unique. </p>
<p>Specially, if \(u = v\), \(u = \frac{1}{\sqrt{a_{11}}}[ \begin{matrix}a_{11} & a_{12}& \cdots& a_{1n} \end{matrix} ] ^\top\).  </p>

</body>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/22/linear_combination_in_so3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoxing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoxing Chen's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/22/linear_combination_in_so3/" class="post-title-link" itemprop="url">Linear Combination in SO(3)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-22 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-22T00:00:00+08:00">2019-10-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-29 16:07:25" itemprop="dateModified" datetime="2020-03-29T16:07:25+08:00">2020-03-29</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/10/22/linear_combination_in_so3/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/10/22/linear_combination_in_so3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <head>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
        <style>
            .bib ol { counter-reset: item }
            .bib li { display: block ; counter-increment: item; }
            .bib li:before { content: " ["counter(item)"] "; }
        </style>
</head>
<body>
    <h2>Motivation</h2>
    <p>
        The dot product of two vectors \(a = [a_1, a_2, \cdots, a_n]\) and \(b = [b_1, b_2, \cdots, b_n]\) is defined as<sup>[1]</sup>:
    </p>
    \[
        \mathbf{a} \cdot \mathbf{b} = \sum_{i=1}^n a_i b_i = a_1 b_1 + a_2 b_2 + \cdots + a_n b_n \tag{1-1}
    \]
    <p>The result can be regarded as a linear combination of elements of \(\mathbf{b}\). 
        It is still valid when \(\mathbf{b}\) is a vector of functions, polynomials and matrices.
    </p>
    <p>
        There is an exception when \(\mathbf{b}\) is a vector of rotations: 
        The result of the product is not guaranteed to stay in the \(S^3\) manifold.
        However the the linear combination of rotations is useful to represent the concepts of Rotation like: 
        <i>mean</i>, <i>weighted average</i>. In this article I will give one intuitive explanation of the derivation.
    </p>

    <h2>Cumulative Form of Inner Product</h2>
    <p>A scalar \(c\) was produced by inner product of two vectors:</p>
    \[
        c = \mathbf{a}^\top \mathbf{b} \tag{2-1}
    \]
    <p>
        For any \(k\)th element of \(\mathbf{a}\):
    </p>
        \[
        c = 
        \left[
        \begin{matrix}
        a_1 \\ a_2 \\ \vdots \\ a_n
        \end{matrix}
        \right]^\top

        \left[
        \begin{matrix}
        b_1 \\ b_2 \\ \vdots \\ b_n
        \end{matrix}
        \right]

        =
        \left(
        
        \left[
        \begin{matrix}
        a_1 \\ a_2 \\ \vdots \\ a_{k-1} \\ a_k \\ \vdots \\ a_n
        \end{matrix}
        \right]^\top

        -

        \left[
        \begin{matrix}
        0 \\ 0 \\ \vdots \\ 0 \\ a_{k-1} \\ \vdots \\ 0
        \end{matrix}
        \right]^\top

        \right)

        \left[
        \begin{matrix}
        b_1 \\ b_2 \\ \vdots \\ b_{k-1} \\ b_k \\ \vdots \\ b_n
        \end{matrix}
        \right]

        + a_{k-1} b_k
        = 
        \left[
        \begin{matrix}
        a_1 \\ a_2 \\ \vdots \\ a_{k-1} \\ a_k - a_{k-1} \\ \vdots \\ a_n
        \end{matrix}
        \right]^\top
        
        \left[
        \begin{matrix}
        b_1 \\ b_2 \\ \vdots \\ b_{k-1} + b_k \\ b_k \\ \vdots \\ b_n
        \end{matrix}
        \right]
        \tag{2-2}
    \]
    <p>After applying transform (2-2) to equation (2-1) for \((n - 1)\) times, start from \(n\), end at \(2\):</p>
    \[
        \left[
        \begin{matrix}
        a_1 \\ a_2 \\ \vdots \\ a_{n-2} \\ a_{n-1} \\ a_n
        \end{matrix}
        \right]^\top

        \left[
        \begin{matrix}
        b_1 \\ b_2 \\ \vdots \\ b_{n-2} \\ b_{n-1} \\ b_n
        \end{matrix}
        \right]

        =
        \left[
        \begin{matrix}
        a_1 \\ a_2 \\ \vdots \\ a_{n-2} \\ a_{n-1} \\ a_n - a_{n-1}
        \end{matrix}
        \right]^\top

        \left[
        \begin{matrix}
        b_1 \\ b_2 \\ \vdots \\ b_{n-2} \\ b_{n-1} + b_n \\ b_n
        \end{matrix}
        \right]

        \\
        =
        \left[
        \begin{matrix}
        a_1 \\ a_2 \\ \vdots \\ a_{n-2} \\ a_{n-1} - a_{n-2} \\ a_n - a_{n-1}
        \end{matrix}
        \right]^\top

        \left[
        \begin{matrix}
        b_1 \\ b_2 \\ \vdots \\ b_{n-2} + b_{n-1} + b_n\\ b_{n-1} + b_n \\ b_n
        \end{matrix}
        \right]

        \\
        \vdots

        \\
        = 
        \left[
        \begin{matrix}
        a_0\\ a_1 - a_0\\ \vdots \\ a_{n-2} - a_{n-3} \\ a_{n-1} - a_{n-2} \\ a_n - a_{n-1}
        \end{matrix}
        \right]^\top

        \left[
        \begin{matrix}
        \sum_{i = 0} ^ n b_i \\ 
        \sum_{i = 1} ^ n b_i \\
        \vdots \\ b_{n-2} + b_{n-1} + b_n\\ b_{n-1} + b_n \\ b_n
        \end{matrix}
        \right]
        \tag{2-3}
    \]
    <p>We obtain:</p>
    \[
        \mathbf{a}^\top \mathbf{b} = 
        \left[
        \begin{matrix}
        a_0\\ a_1 - a_0\\ \vdots \\ a_{n-2} - a_{n-3} \\ a_{n-1} - a_{n-2} \\ a_n - a_{n-1}
        \end{matrix}
        \right]^\top

        \left[
        \begin{matrix}
        \sum_{i = 0} ^ n b_i \\ 
        \sum_{i = 1} ^ n b_i \\
        \vdots \\ 
        \sum_{i = n-2} ^ n b_i \\ 
        \sum_{i = n-1} ^ n b_i \\ 
        b_n
        \end{matrix}
        \right]
        
        \tag{2-4}
    \]
    <p>Formula (2-4) can be written as: </p>
    \[
        \mathbf{a}^\top \mathbf{b} = \Delta \mathbf{a}^\top \mathbf{\tilde B} \\
        \Delta {a}_i = 
        \begin{cases}
        a_1 & \text{if} \ i = 1 \\
        a_{i} - a_{i-1} & \text{otherwise}
        \end{cases} \\
        {\tilde B}_i = \sum_{j = n-i} ^ n b_j
        \tag{2-5}

    \]

    <h3>Examples of Cumulative formula</h3>
    <h4>Midpoint of Two Points</h4>
    <p>Given two points \(b_1\) and \(b_2\), the midpoint of them is:</p>
    \[
        b_m = \frac{b_1 + b_2}{2}
        \tag{2-6}
    \]
    <p>
        Formulate (2-6) can be converted to inner product form: \(b_m = \mathbf{a}^\top \mathbf{b}\), where \(\mathbf{a} = [\frac{1}{2}, \frac{1}{2}]^\top\).
        The midpoint can also be represented as position of the first point plus the half-distance between these two points:
    </p>
    \[
        b_m = b_1 + \frac{1}{2}(b_2 - b_1)
        \tag{2-7}
    \]
    <p>Formulate (2-7) corresponds to the cumulative form.</p>
    <h4>Midpoint of Three Points</h4>
    <p>Given three points \(b_1\), \(b_2\) and \(b_3\), the midpoint of them is:</p>
    \[
        b_m = \frac{b_1 + b_2 + b_3}{3}
        \tag{2-8}
    \]
    <p>In cumulative form: </p>
    \[
        b_m = b_1 + \frac{2}{3}(b_2 - b_1) + \frac{1}{3}(b_3 - b_2) 
        \tag{2-9}
    \]

    <br>
    <p>From the two examples above we can see, the cumulative formula converts the combination of vector elements to the 
        combination of the difference between vector elements.
    </p>
    <h2>Linear Combination of Rotations</h2>
    <p>As we know, the <b>Addition</b> was not defined in \(SO(3)\). 
        One can not calculate the "midpoint" of two rotations by adding two rotations.
        Similarly, the <b>Multiplication</b> between scalar and matrices, which means the "cumulation of addition"
        is also invalid.
        Instead, the "cumulation" of a rotation is defined by exponential operation and 
        the "distance" between rotations is be calculated by:
    </p>
    \[
        \Delta R = R_2 R_1^\top
        \tag{3-1}
    \]
    <p>Therefore, the interpolation between two rotations can be represented as:</p>
    \[
        R(t) = (R_2 R_1^\top)^t R_1
        \tag{3-2}
    \]
    <p>Finally, the linear combination \(R_m\) of rotations \(R_i\) with weights \(w_i\) can be derived
         from cumulative formula (2-5)<sup>[2]</sup>:</p>
    \[
        R_m = \prod_{i = 1}^n (\Delta R_i) ^{\tilde w_i} \\
        \Delta {R}_i = 
        \begin{cases}
        R_1 & \text{if} \ i = 1 \\
        R_{i}R_{i-1}^T & \text{otherwise}
        \end{cases} \\
        {\tilde w}_i = \sum_{j = n-i} ^ n w_j
        \tag{3-3}
    \]
    <h3>Example: Average of Four Rotations</h3>
    <p>Given four rotations \(R_1\), \(R_2\), \(R_3\) and \(R_4\), the midpoint of them is:</p>
    \[
        R_m =  
        (R_4 R_3^\top)^{\frac{1}{4}}
        (R_3 R_2^\top)^{\frac{2}{4}}
        (R_2 R_1^\top)^{\frac{3}{4}}
        R_1  
        \tag{3-4}
    \]
    <h2>References</h2>
    <ol class="bib">
        <li>
            S. Lipschutz; M. Lipson (2009). <cite>Linear Algebra (Schaum’s Outlines)</cite> (4th ed.). McGraw Hill
        </li>
        <li>Kim, M.J., Kim, M.S. and Shin, S.Y., 1995, September.
            <cite>
                <a href="http://graphics.cs.cmu.edu/nsp/course/15-464/Fall05/papers/kimKimShin.pdf" target="_blank" rel="noopener">
                    A general construction scheme for unit quaternion curves with simple high order derivatives.        
                </a>
            </cite>
            In Proceedings of the 22nd annual conference on Computer graphics and interactive techniques (pp. 369-376).
        </li>
        <li>
            Moakher, Maher, 
            <cite>
                <a href="https://lcvmwww.epfl.ch/publications/data/articles/63/simaxpaper.pdf" target="_blank" rel="noopener">
                    Means and averaging in the group of rotations
                </a>
            </cite>
                ,SIAM journal on matrix analysis and applications 24.1 (2002): 1-16.
        </li>
        <li>
            Markley, F. Landis, et al.
            <cite>
            <a href="http://www.acsu.buffalo.edu/~johnc/ave_quat07.pdf" target="_blank" rel="noopener">
                "Averaging Quaternions."
            </a>
        </cite>
            Journal of Guidance, Control, and Dynamics 30.4 (2007): 1193-1197.
        </li>
        <li>
            Hartley, Richard, et al. 
            <cite><a href="http://users.cecs.anu.edu.au/~hongdong/rotationaveraging.pdf" target="_blank" rel="noopener">"Rotation averaging."</a></cite>
            International journal of computer vision 103.3 (2013): 267-305.
        </li>
    </ol>
</body>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xiaoxing</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiaoxingchen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiaoxingchen" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chen-xx@zju.edu.cn" title="E-Mail → mailto:chen-xx@zju.edu.cn" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/%E7%AC%91%E8%A1%8C-%E9%99%88-8b96ba10a/" title="LinkedIn → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;%E7%AC%91%E8%A1%8C-%E9%99%88-8b96ba10a&#x2F;" rel="noopener" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i>LinkedIn</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://xiaoxingchen.github.io/resume/resume_en.html" title="Resume → https:&#x2F;&#x2F;xiaoxingchen.github.io&#x2F;resume&#x2F;resume_en.html" rel="noopener" target="_blank"><i class="fa fa-fw fa-address-card"></i>Resume</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiaoxing</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.2
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://xiaoxingchen.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
